<<<<<<< HEAD
<div class='event'>
  <div class='event-area'>
  <div class='event-form'>
  <%= form_for( '/events', method: :post )  do |f| %>
    <h3>
      イベントを作成します
    </h3>
    <p>イベント名：<%= f.text_field :title %></p>
    <p>開催日時：<%= f.datetime_select :start %></p>
    <p>開催場所：<%= f.text_field :venue %></p>
    <p>イベント内容：</p>
    <%= f.text_area :content,  placeholder: 'イベントの内容を書いてください！', style: 'width: 400px; height: 200px;' %>
    <p>定　員：<%= f.number_field :capacity, min: 1, style: 'width: 40px; height: 20px;' %>人</p>
    <p>画　像：<%= f.file_field :image %></p>
    <p>※画像ファイルは400px x 300px 以内のJEPG形式でお願いします</p>
    <p><%= f.submit 'イベント作成', class: 'event-button' %></p>
    
  <% end %>
=======

<%= render "shared/flash" %>
<div class="container">
  <div class="row">
    <div class="col-12 col-sm-3">
      <%= render "shared/sidebar_organizer" %>
    </div>  
  
    <div class='col-12 col-sm-9 content'>
      <div class="page-title">
        <h1>イベント作成</h1>
      </div>
      
      <div class="event">
        <div id="error-notice"></div>
        <%= form_with(model: @event, url: events_path, method: :post) do |f| %>
          <div class="event-form">
            <label for="event_title">イベント名<br><span class="pink-btn form-necessary">必須</span></label>
            <%= f.text_field:title, class:"form-control form-control-lg" %>
          </div>
          <div class="event-form event-form-date">
            <label for="event_start_date">開催日時<br><span class="pink-btn form-necessary">必須</span></label>
            <%= f.date_field:start_date, class:"form-control" %>
            <%= f.time_select:start_time, {}, class:"form-control", ignore_data:true %>
          </div>
          <div class="event-form">
            <label for="event_content">イベント内容<br><span class="pink-btn form-necessary">必須</span></label>
            <%= f.text_area:content, class:"form-control form-control-lg event-form-content", placeholder: "開催するイベントの内容を書いてください" %>
          </div>
          <div class="event-form">
            <label for="event_venue">Zoom ID<br><span class="pink-btn form-necessary">必須</span></label>
            <%= f.text_field:venue, class:"form-control form-control-lg" %>
          </div>
          <div class="event-form">
            <label for="event_venue_pass">Zoom Password<br><span class="pink-btn form-necessary">必須</span></label>
            <%= f.text_field:venue_pass, class:"form-control form-control-lg" %>
          </div>
          <div class="event-form">
            <label for="event_capacity">定員<br><span class="pink-btn form-necessary">必須</span></label>
            <%= f.number_field:capacity, class:"form-control form-control-lg" %>
          </div>
          <div class="event-form">
            <label for="event_price">参加費<br><span class="pink-btn form-necessary">必須</span></label>
            <%= f.number_field:price, class:"form-control form-control-lg" %>
          </div>
          <div class="event-form">
            <label for="event_imgs">画像<br><span class="pink-btn form-necessary">必須</span></label>
            <label class="event-form__img-field" for="img-file"><span class="submit-btn blue-border-btn"><i class="fa fa-image" aria-hidden="true"></i> 画像をアップロード</span></label>
            <%= f.file_field:imgs, multiple: true, class:"", id:"img-file", style:"display:none" %>
          </div>
          <div id="event-form__img"></div>
          <div class="event-submit">
            <%= f.submit "イベント作成", class:"submit-btn blue-btn btn-hover" %>
          </div>
        <% end %>
      </div>
    </div>
    
>>>>>>> dc21a8650bcc40630bd6fd1c0917b48181565942
  </div>
</div>




<script>
$(function(){
  var dataBox = new DataTransfer();
  var file_field = document.querySelector('input[type=file]');
  $('#img-file').change(function(){
    var files = $('input[type="file"]').prop('files')[0];
    $.each(this.files, function(i, file){
      var fileReader = new FileReader();
      dataBox.items.add(file);
      file_field.files = dataBox.files
      var num = $('.item-image').length + 1 + i
      fileReader.readAsDataURL(file);

      if (num == 10){
        $('#image-box__container').css('display', 'none');   
      }
  
      fileReader.onloadend = function() {
        var src = fileReader.result
        var imgBox= 
          `<div class="event-form__img-wrap item-image" data-image="${file.name}">
            <div class="event-form__img-box">
              <img src=${src} class="event-form__img">
            </div>
            <div class="event-form__img-remove">
              <p><i class="fa fa-remove btn-hover" aria-hidden="true"></i></p>
            </div>
          </div>`
          
        $('#event-form__img').append(imgBox);
      };
      $('#image-box__container').attr('class', `item-num-${num}`);
    });
  });
  
  //削除関連
  $(document).on("click", '.event-form__img-remove', function(){
    var target_image = $(this).parent();
    var target_name = $(target_image).data('image')
    
    if(file_field.files.length == 1){
      ("input[type=file]").val(null);
      dataBox.clearData();
      console.log(dataBox);
    }else{
      
      $.each(file_field.files, function(i,input){
        if(input.name == target_name){
          dataBox.items.remove(i);
        }
      });
      file_field.files = dataBox.files
    }
    target_image.remove();
    var num = $('.item-image').length
    $('#image-box__container').show()
    $('#image-box__container').attr('class', `item-num-${num}`)
  })
});
</script>